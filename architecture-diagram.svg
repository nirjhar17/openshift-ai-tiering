<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 1100">
  <defs>
    <!-- Gradients -->
    <linearGradient id="bgGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#0f172a"/>
      <stop offset="100%" style="stop-color:#1e293b"/>
    </linearGradient>
    
    <linearGradient id="gatewayGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#3b82f6"/>
      <stop offset="100%" style="stop-color:#1d4ed8"/>
    </linearGradient>
    
    <linearGradient id="wasmGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#8b5cf6"/>
      <stop offset="100%" style="stop-color:#6d28d9"/>
    </linearGradient>
    
    <linearGradient id="authGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#f59e0b"/>
      <stop offset="100%" style="stop-color:#d97706"/>
    </linearGradient>
    
    <linearGradient id="limitGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#ef4444"/>
      <stop offset="100%" style="stop-color:#dc2626"/>
    </linearGradient>
    
    <linearGradient id="routeGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#10b981"/>
      <stop offset="100%" style="stop-color:#059669"/>
    </linearGradient>
    
    <linearGradient id="modelGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#06b6d4"/>
      <stop offset="100%" style="stop-color:#0891b2"/>
    </linearGradient>
    
    <linearGradient id="arrowGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#60a5fa"/>
      <stop offset="100%" style="stop-color:#a78bfa"/>
    </linearGradient>

    <!-- Glow filter -->
    <filter id="glow" x="-20%" y="-20%" width="140%" height="140%">
      <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
      <feMerge>
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
    
    <!-- Shadow filter -->
    <filter id="shadow" x="-10%" y="-10%" width="120%" height="130%">
      <feDropShadow dx="0" dy="4" stdDeviation="8" flood-color="#000" flood-opacity="0.3"/>
    </filter>

    <!-- Arrow marker -->
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#60a5fa"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="900" height="1100" fill="url(#bgGrad)"/>
  
  <!-- Grid pattern -->
  <g opacity="0.05">
    <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
      <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#fff" stroke-width="0.5"/>
    </pattern>
    <rect width="900" height="1100" fill="url(#grid)"/>
  </g>

  <!-- Title -->
  <text x="450" y="50" text-anchor="middle" fill="#f1f5f9" font-family="system-ui, -apple-system, sans-serif" font-size="28" font-weight="700" letter-spacing="2">
    MaaS GATEWAY REQUEST FLOW
  </text>
  <text x="450" y="75" text-anchor="middle" fill="#64748b" font-family="system-ui, sans-serif" font-size="12" letter-spacing="1">
    AUTHENTICATION â€¢ RATE LIMITING â€¢ ROUTING
  </text>

  <!-- User Request -->
  <g filter="url(#shadow)">
    <rect x="325" y="95" width="250" height="50" rx="25" fill="#334155" stroke="#475569" stroke-width="2"/>
    <text x="450" y="125" text-anchor="middle" fill="#e2e8f0" font-family="system-ui, sans-serif" font-size="14" font-weight="600">
      ðŸ‘¤ User Request + Bearer Token
    </text>
  </g>

  <!-- Arrow 1 -->
  <line x1="450" y1="145" x2="450" y2="175" stroke="url(#arrowGrad)" stroke-width="3" marker-end="url(#arrowhead)"/>

  <!-- 1. Gateway -->
  <g filter="url(#shadow)">
    <rect x="100" y="180" width="700" height="90" rx="12" fill="#1e293b" stroke="url(#gatewayGrad)" stroke-width="2"/>
    <rect x="100" y="180" width="700" height="30" rx="12" fill="url(#gatewayGrad)"/>
    <rect x="100" y="198" width="700" height="12" fill="url(#gatewayGrad)"/>
    <circle cx="125" cy="195" r="6" fill="#22c55e"/>
    <text x="145" y="200" fill="#fff" font-family="system-ui, sans-serif" font-size="14" font-weight="700">1. GATEWAY</text>
    <text x="770" y="200" text-anchor="end" fill="#94a3b8" font-family="monospace" font-size="11">maas-gateway</text>
    <text x="120" y="235" fill="#cbd5e1" font-family="system-ui, sans-serif" font-size="12">â€¢ Receives HTTPS request</text>
    <text x="120" y="255" fill="#cbd5e1" font-family="system-ui, sans-serif" font-size="12">â€¢ Terminates TLS</text>
    <text x="450" y="235" fill="#cbd5e1" font-family="system-ui, sans-serif" font-size="12">â€¢ Annotation: opendatahub.io/managed: "false"</text>
  </g>

  <!-- Arrow 2 -->
  <line x1="450" y1="270" x2="450" y2="300" stroke="url(#arrowGrad)" stroke-width="3" marker-end="url(#arrowhead)"/>

  <!-- 2. WASM Plugin -->
  <g filter="url(#shadow)">
    <rect x="100" y="305" width="700" height="100" rx="12" fill="#1e293b" stroke="url(#wasmGrad)" stroke-width="2"/>
    <rect x="100" y="305" width="700" height="30" rx="12" fill="url(#wasmGrad)"/>
    <rect x="100" y="323" width="700" height="12" fill="url(#wasmGrad)"/>
    <circle cx="125" cy="320" r="6" fill="#22c55e"/>
    <text x="145" y="325" fill="#fff" font-family="system-ui, sans-serif" font-size="14" font-weight="700">2. WASM PLUGIN</text>
    <text x="770" y="325" text-anchor="end" fill="#94a3b8" font-family="monospace" font-size="11">auto-created by Kuadrant</text>
    <text x="120" y="360" fill="#cbd5e1" font-family="system-ui, sans-serif" font-size="12">â€¢ Intercepts request BEFORE backend</text>
    <text x="120" y="385" fill="#cbd5e1" font-family="system-ui, sans-serif" font-size="12">â€¢ Contains two services:</text>
    
    <!-- Service boxes -->
    <rect x="300" y="355" width="160" height="40" rx="6" fill="#3b0764" stroke="#8b5cf6" stroke-width="1"/>
    <text x="380" y="380" text-anchor="middle" fill="#e9d5ff" font-family="monospace" font-size="11">auth-service</text>
    
    <rect x="480" y="355" width="160" height="40" rx="6" fill="#3b0764" stroke="#8b5cf6" stroke-width="1"/>
    <text x="560" y="380" text-anchor="middle" fill="#e9d5ff" font-family="monospace" font-size="11">ratelimit-service</text>
  </g>

  <!-- Arrow 3 -->
  <line x1="450" y1="405" x2="450" y2="435" stroke="url(#arrowGrad)" stroke-width="3" marker-end="url(#arrowhead)"/>

  <!-- 3. Authorino -->
  <g filter="url(#shadow)">
    <rect x="100" y="440" width="700" height="200" rx="12" fill="#1e293b" stroke="url(#authGrad)" stroke-width="2"/>
    <rect x="100" y="440" width="700" height="30" rx="12" fill="url(#authGrad)"/>
    <rect x="100" y="458" width="700" height="12" fill="url(#authGrad)"/>
    <circle cx="125" cy="455" r="6" fill="#22c55e"/>
    <text x="145" y="460" fill="#fff" font-family="system-ui, sans-serif" font-size="14" font-weight="700">3. AUTHORINO</text>
    <text x="770" y="460" text-anchor="end" fill="#94a3b8" font-family="monospace" font-size="11">kuadrant-system namespace</text>
    
    <!-- Step boxes -->
    <rect x="120" y="480" width="320" height="45" rx="6" fill="#451a03" stroke="#f59e0b" stroke-width="1"/>
    <text x="130" y="498" fill="#fcd34d" font-family="system-ui, sans-serif" font-size="11" font-weight="600">3a: kubernetesTokenReview</text>
    <text x="130" y="515" fill="#fde68a" font-family="system-ui, sans-serif" font-size="10">Validates Bearer token â†’ returns username, groups</text>
    
    <rect x="460" y="480" width="320" height="45" rx="6" fill="#451a03" stroke="#f59e0b" stroke-width="1"/>
    <text x="470" y="498" fill="#fcd34d" font-family="system-ui, sans-serif" font-size="11" font-weight="600">3b: HTTP Metadata (MaaS API)</text>
    <text x="470" y="515" fill="#fde68a" font-family="system-ui, sans-serif" font-size="10">POST /v1/tiers/lookup â†’ {"tier": "premium"}</text>
    
    <rect x="120" y="535" width="320" height="45" rx="6" fill="#451a03" stroke="#f59e0b" stroke-width="1"/>
    <text x="130" y="553" fill="#fcd34d" font-family="system-ui, sans-serif" font-size="11" font-weight="600">3c: kubernetesSubjectAccessReview</text>
    <text x="130" y="570" fill="#fde68a" font-family="system-ui, sans-serif" font-size="10">RBAC check for LLMInferenceService access</text>
    
    <rect x="460" y="535" width="320" height="45" rx="6" fill="#451a03" stroke="#f59e0b" stroke-width="1"/>
    <text x="470" y="553" fill="#fcd34d" font-family="system-ui, sans-serif" font-size="11" font-weight="600">3d: Response Filter</text>
    <text x="470" y="570" fill="#fde68a" font-family="system-ui, sans-serif" font-size="10">Adds: auth.identity.tier = "premium"</text>

    <!-- Output indicator -->
    <rect x="120" y="590" width="660" height="35" rx="6" fill="#166534" stroke="#22c55e" stroke-width="1"/>
    <text x="450" y="612" text-anchor="middle" fill="#86efac" font-family="monospace" font-size="12">
      OUTPUT â†’ auth.identity.tier passed to Limitador
    </text>
  </g>

  <!-- Arrow 4 -->
  <line x1="450" y1="640" x2="450" y2="670" stroke="url(#arrowGrad)" stroke-width="3" marker-end="url(#arrowhead)"/>

  <!-- 4. Limitador -->
  <g filter="url(#shadow)">
    <rect x="100" y="675" width="700" height="140" rx="12" fill="#1e293b" stroke="url(#limitGrad)" stroke-width="2"/>
    <rect x="100" y="675" width="700" height="30" rx="12" fill="url(#limitGrad)"/>
    <rect x="100" y="693" width="700" height="12" fill="url(#limitGrad)"/>
    <circle cx="125" cy="690" r="6" fill="#22c55e"/>
    <text x="145" y="695" fill="#fff" font-family="system-ui, sans-serif" font-size="14" font-weight="700">4. LIMITADOR</text>
    <text x="770" y="695" text-anchor="end" fill="#94a3b8" font-family="monospace" font-size="11">kuadrant-system namespace</text>
    
    <!-- Tier limits -->
    <rect x="120" y="715" width="200" height="35" rx="6" fill="#1c1917" stroke="#78716c" stroke-width="1"/>
    <text x="220" y="737" text-anchor="middle" fill="#a8a29e" font-family="monospace" font-size="11">free: 5 req/2min</text>
    
    <rect x="340" y="715" width="200" height="35" rx="6" fill="#1c1917" stroke="#fbbf24" stroke-width="1"/>
    <text x="440" y="737" text-anchor="middle" fill="#fcd34d" font-family="monospace" font-size="11">premium: 20 req/2min</text>
    
    <rect x="560" y="715" width="200" height="35" rx="6" fill="#1c1917" stroke="#a855f7" stroke-width="1"/>
    <text x="660" y="737" text-anchor="middle" fill="#d8b4fe" font-family="monospace" font-size="11">enterprise: 50 req/2min</text>
    
    <!-- Decision -->
    <rect x="200" y="760" width="220" height="40" rx="20" fill="#166534" stroke="#22c55e" stroke-width="2"/>
    <text x="310" y="785" text-anchor="middle" fill="#86efac" font-family="system-ui, sans-serif" font-size="12" font-weight="600">âœ“ Under limit â†’ ALLOW</text>
    
    <rect x="480" y="760" width="220" height="40" rx="20" fill="#7f1d1d" stroke="#ef4444" stroke-width="2"/>
    <text x="590" y="785" text-anchor="middle" fill="#fca5a5" font-family="system-ui, sans-serif" font-size="12" font-weight="600">âœ— Over limit â†’ 429</text>
  </g>

  <!-- Arrow 5 (if allowed) -->
  <line x1="450" y1="815" x2="450" y2="845" stroke="url(#arrowGrad)" stroke-width="3" marker-end="url(#arrowhead)"/>
  <text x="460" y="835" fill="#22c55e" font-family="system-ui, sans-serif" font-size="10" font-style="italic">if allowed</text>

  <!-- 5. HTTPRoute -->
  <g filter="url(#shadow)">
    <rect x="100" y="850" width="700" height="80" rx="12" fill="#1e293b" stroke="url(#routeGrad)" stroke-width="2"/>
    <rect x="100" y="850" width="700" height="30" rx="12" fill="url(#routeGrad)"/>
    <rect x="100" y="868" width="700" height="12" fill="url(#routeGrad)"/>
    <circle cx="125" cy="865" r="6" fill="#22c55e"/>
    <text x="145" y="870" fill="#fff" font-family="system-ui, sans-serif" font-size="14" font-weight="700">5. HTTPROUTE</text>
    <text x="770" y="870" text-anchor="end" fill="#94a3b8" font-family="monospace" font-size="11">my-first-model namespace</text>
    
    <text x="120" y="905" fill="#cbd5e1" font-family="system-ui, sans-serif" font-size="12">â€¢ Routes request to model backend</text>
    <text x="120" y="920" fill="#6ee7b7" font-family="monospace" font-size="11">â€¢ Path rewrite: /my-first-model/qwen3-0-6b â†’ /v1/chat/completions</text>
  </g>

  <!-- Arrow 6 -->
  <line x1="450" y1="930" x2="450" y2="960" stroke="url(#arrowGrad)" stroke-width="3" marker-end="url(#arrowhead)"/>

  <!-- 6. Model Backend -->
  <g filter="url(#shadow)">
    <rect x="100" y="965" width="700" height="80" rx="12" fill="#1e293b" stroke="url(#modelGrad)" stroke-width="2"/>
    <rect x="100" y="965" width="700" height="30" rx="12" fill="url(#modelGrad)"/>
    <rect x="100" y="983" width="700" height="12" fill="url(#modelGrad)"/>
    <circle cx="125" cy="980" r="6" fill="#22c55e"/>
    <text x="145" y="985" fill="#fff" font-family="system-ui, sans-serif" font-size="14" font-weight="700">6. MODEL BACKEND</text>
    <text x="770" y="985" text-anchor="end" fill="#94a3b8" font-family="monospace" font-size="11">vLLM</text>
    
    <text x="120" y="1020" fill="#cbd5e1" font-family="system-ui, sans-serif" font-size="12">â€¢ Processes the LLM request</text>
    <text x="450" y="1020" fill="#cbd5e1" font-family="system-ui, sans-serif" font-size="12">â€¢ Returns response to user</text>
    
    <!-- LLM icon -->
    <text x="750" y="1025" text-anchor="middle" fill="#67e8f9" font-size="24">ðŸ¤–</text>
  </g>

  <!-- Footer -->
  <text x="450" y="1075" text-anchor="middle" fill="#475569" font-family="system-ui, sans-serif" font-size="11">
    Kuadrant + OpenShift AI â€¢ Gateway API Architecture
  </text>
</svg>
